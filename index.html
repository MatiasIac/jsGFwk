<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
	
	<script src="https://raw.githubusercontent.com/MatiasIac/jsGFwk/master/Framework/jsGFwk.js"></script>
	<script src="https://raw.githubusercontent.com/MatiasIac/jsGFwk/master/jsGFwk2dFastAnimation.js"></script>
	<script src="https://raw.githubusercontent.com/MatiasIac/jsGFwk/master/jsGFwkRM.js"></script>
	<script src="https://raw.githubusercontent.com/MatiasIac/jsGFwk/master/jsGFwkIO.js"></script>
	
    <title>jsGFwk by Matias Iacono</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>jsGFwk</h1>
        <h2>Minimalistic videogame framework</h2>
        <a href="https://github.com/matiasiac/jsGFwk" class="button"><small>View project on</small>GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
			<h1>
				<a name="jsgfwk" class="anchor" href="#jsgfwk"><span class="octicon octicon-link"></span></a>Play a little
			</h1>
			<div>
				<h3>First game made with jsGFwk</h3>
				<p>This is the first game test made with jsGFwk.<br>
				Is unfinished but demonstrate the powerful of this simple video game framework.<br>
				Use the LEFT and RIGHT arrow to move the ship. X to shoot, and D to die.</p>
				<canvas id="canvas" width="320" height="240"></canvas>
				<p>If you don't see it, refresh the page a couple of times. Sometimes GitHub doesn't provide the files correctly.</p>
			</div>
			<br>
			<br>
			<h3>First steps</h3>
			<div>
				<h4>Set up your page</h4>
				<p>Add a canvas element to the DOM</p>
				<code>
					&#60;canvas id="canvas" width="640" height="480"&#62;
				</code>
				<p>Import the proper scripts</p>
				<code>
					&#60;script src="/Framework/jsGFwk.js"&#62;&#60;/script&#62; <br>
					&#60;script src="/Framework/jsGFwkBasicAnimation.js"&#62;&#60;/script&#62;
				</code>
				<p>Set up the framework and add objects</p>
				<code>
					jsGFwk.settings.canvas = "canvas"; <br>
					jsGFwk.settings.clearColor = "rgb(0, 0, 0)"; <br>
					
					// Include the plugin <br>
					jsGFwk.include("BasicAnimation"); <br>
					 <br>
					// Create an object game <br>
					jsGFwk.createObject({ <br>
						id: "enemy", <br>
						visible: true, <br>
						x: 650, <br>
						y: 200, <br>
						width: 50, <br>
						height: 50, <br>
						update: function (delta) { <br>
							this.x -= 1.5; <br>
							if (this.x + this.width < 0) { <br>
								this.x = 650; <br>
							} <br>
						}, <br>
						draw: function (context) { <br>
							context.save(); <br>
								context.fillStyle = "blue"; <br>
								context.fillRect(this.x, this.y, this.width, this.height); <br>
							context.restore(); <br>
						} <br>
					}); <br>		
				</code>
			</div>
			<br>
			<br>
			<br>
			<h3>Learn to use it with videos (Spanish only)</h3>
			<div>
				<iframe width="560" height="315" src="//www.youtube.com/embed/6BPy_haAHmE?list=PLL6dtBDFEE6egmnLlCLsxx0hjGvpy1cuZ" frameborder="0" allowfullscreen></iframe>
			</div>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/matiasiac/jsGFwk/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/matiasiac/jsGFwk/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/matiasiac/jsGFwk"></a> is maintained by <a href="https://github.com/matiasiacono">matiasiacono</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

	<script language="Javascript">
		jsGFwk.settings.canvas = "canvas";
		jsGFwk.settings.clearColor = "rgb(0,0,0)";
		
		jsGFwk.include("FastAnimation");
		jsGFwk.include("ResourceManager");
		jsGFwk.include("IO");
		
		jsGFwk.ResourceManager.addGraphic({ name: "sprites", source: "https://rawgithub.com/MatiasIac/jsGFwk/master/SampleGames/Galaga/sprites.png" });
		jsGFwk.ResourceManager.addSound({ name: "spaceShipShoot", source: "https://rawgithub.com/MatiasIac/jsGFwk/master/SampleGames/Galaga/shoot.wav" });
		jsGFwk.ResourceManager.addSound({ name: "generalExplosion", source: "https://rawgithub.com/MatiasIac/jsGFwk/master/SampleGames/Galaga/explode.wav" });
		
		jsGFwk.createObject({
			id: "progress",
			visible: true,
			barWidth: 0,
			init: function() {
				jsGFwk.ResourceManager.onResourcesLoadedCompleted = function() {
					buildGame();
					jsGFwk._gameObjects.progress.destroy();
				};
			},
			update: function(delta) {
				var a = (jsGFwk.ResourceManager._totalLoadedResources * 100) / jsGFwk.ResourceManager._totalResources;
				this.barWidth = (a * 320) / 100;
			},
			draw: function (context) {
				context.save();
					context.fillStyle = "#FF0000";
					context.fillRect(0,0, 320, 240);
					
					context.fillStyle = "#FFFFFF";
					context.fillText("Loading...", 140, 120);
					
					context.strokeStyle = "#FFFFFF";
					context.strokeRect(10, 140, 300, 10);
					context.fillRect(10, 140, this.barWidth, 10);
				context.restore();
			}
		});
		
		jsGFwk.start();
		
		function buildGame() {
			//Starfield
			jsGFwk.createObject({
				id: "starBackground",
				zOrder: 0,
				offset: 0,
				starImage: {},
				init: function () {	
					var c = document.createElement("canvas");
					c.width = 320;
					c.height = 240;
					var ctx = c.getContext("2d");
					ctx.beginPath();
					ctx.fillStyle="black";
					ctx.rect(0,0,320,240);
					ctx.fill();
					ctx.beginPath();
					for (var n=0; n < 100; n++){
						var x=parseInt(Math.random() * canvas.width);
						var y=parseInt(Math.random() * canvas.height);
						var radius=Math.random() * 1;
						ctx.arc(x, y, radius, 0, Math.PI * 2, false);
						ctx.closePath();
					}
					ctx.fillStyle="white";
					ctx.fill();

					this.starImage = new Image();
					this.starImage.src = c.toDataURL();
				},
				visible: true,
				update: function(delta) {
					this.offset-=1;
					if(this.offset < 0){ this.offset = 240; }
				},
				draw: function (context) {
					context.drawImage(this.starImage,0, -this.offset);
					context.drawImage(this.starImage,0, 240 - this.offset);
				}
			});
		
			//Starship
			jsGFwk.createObject({
				//Draw actions
				_drawAliveShip: function(context){
					context.drawImage(jsGFwk.ResourceManager.graphics.sprites.image,
						169, 19, 15, 16, 
						jsGFwk._gameObjects.spaceShip.x, jsGFwk._gameObjects.spaceShip.y, 15, 16);
						
					for (var bullet in jsGFwk._gameObjects.spaceShip.bullets) {
						context.drawImage(jsGFwk.ResourceManager.graphics.sprites.image,
							351, 159, 3, 8,	
							jsGFwk._gameObjects.spaceShip.bullets[bullet].x, 
							jsGFwk._gameObjects.spaceShip.bullets[bullet].y, 3, 8);
					}
				},
				_drawDeadShip: function(context) {
					context.drawImage(jsGFwk.ResourceManager.graphics.sprites.image,
						193 + (32 * this._deadCurrentFrame), 11, 32, 32, 
						jsGFwk._gameObjects.spaceShip.x - 10, jsGFwk._gameObjects.spaceShip.y - 10, 32, 32);
				},
				//***
				
				//Update actions
				_updateDeadShip: function(delta) {
					if (this.delayCounter >= 0.7) {
						this._deadCurrentFrame++;
						this.delayCounter = 0;
						
						if (this._deadCurrentFrame === 5) {
							this.delayCounter = 0;
							this._updateShipAction = this._updateAliveShip;
							this._drawShipAction = this._drawAliveShip;
							this._deadCurrentFrame = 0;
						}
					}
				},
				_updateAliveShip: function(delta) {
					if (jsGFwk.IO.keyboard._activeKey[39] && this.x <= 300) { this.x+=this.shipSpeed; }
					if (jsGFwk.IO.keyboard._activeKey[37] && this.x >= 5) { this.x-=this.shipSpeed; }
					if (jsGFwk.IO.keyboard._activeKey[88]) { 
						if (this.bullets.length < 3 && this.delayCounter >= this.bulletShootDelay || this.bullets.length == 0) {
							this.delayCounter = 0;
							this.bullets.push({x: this.x + 7, y: this.y - 8});
							jsGFwk.ResourceManager.sounds.spaceShipShoot.audio.play();
						}
					}
					
					for (var i = 0; i < this.bullets.length;) {
						this.bullets[i].y -= this.bulletSpeed;
						var coords = this._getBulletGridRelation(this.bullets[i]);
											
						if (coords.y === -1) {
							this.bullets.splice(i, 1);
						} else if (jsGFwk._gameObjects.formation.formation[coords.y][coords.x] !== 5) {
							var newValue = jsGFwk._gameObjects.formation.formation[coords.y][coords.x] === 0 ? 1 : 5;
							jsGFwk._gameObjects.formation.formation[coords.y][coords.x] = newValue;
							this.bullets.splice(i, 1);
							jsGFwk.ResourceManager.sounds.generalExplosion.audio.play();
						} else { i++; }
					}
					
					if (jsGFwk.IO.keyboard._activeKey[68]) {
						jsGFwk.ResourceManager.sounds.generalExplosion.audio.play();
						this.delayCounter = 0;
						this.bullets.splice(0, this.bullets.length);
						this._updateShipAction = this._updateDeadShip;
						this._drawShipAction = this._drawDeadShip;
					}
				},
				//***
				
				//Draw pointers
				_drawShipAction: function() {},
				_updateShipAction: function() {},
				//***
				
				//bullet: x and y of that bullet
				_getBulletGridRelation: function (bullet) {
					return { x: (Math.floor(bullet.x / 15)),
						y: (Math.floor(bullet.y / 15)) };
				},
				
				_deadCurrentFrame: 0,
				
				id: "spaceShip",
				x: 150,
				y: 200,
				shipSpeed: 1.5,
				bulletSpeed: 2.5,
				bulletShootDelay: 0.7,
				delayCounter: 0,
				bullets: [],
				zOrder: 1,
				init: function() {
					this._drawShipAction = this._drawAliveShip;
					this._updateShipAction = this._updateAliveShip;
				},
				visible: true,
				update: function(delta) {
					this.delayCounter+=delta;
					this._updateShipAction(delta);
				},
				draw: function (context) {
					this._drawShipAction(context);
				}
			});
			
			//Enemies
			jsGFwk.createObject({
				id: "formation",
				_currentFrame: 0,
				_maxFrame: 2,
				formation: [],
				delayCounter: 0,
				
				//The grid define the game layout
				init: function () {	
					this.formation[0] = [5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5];
					this.formation[1] = [5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5];
					this.formation[2] = [5,5,0,5,0,5,1,5,5,5,5,5,5,5,1,5,0,5,0,5];
					this.formation[3] = [5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5];
					this.formation[4] = [5,5,2,5,2,5,2,5,2,5,2,5,2,5,2,5,2,5,2,5];
					this.formation[5] = [5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5];
					this.formation[6] = [5,5,3,5,3,5,3,5,3,5,3,5,3,5,3,5,3,5,3,5];
					this.formation[7] = [5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5];
					this.formation[8] = [5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5];
					this.formation[9] = [5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5];
					this.formation[10] = [5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5];
					this.formation[11] = [5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5];
					this.formation[12] = [5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5];
				},
				visible: true,
				update: function(delta) {
					this.delayCounter+=delta;
					
					//Reset all the enemies
					if (jsGFwk.IO.keyboard._activeKey[82]) { this.init(); }
					
					if (this.delayCounter > 0.5) {
						this._currentFrame++;
						this._currentFrame = this._currentFrame % this._maxFrame;
						this.delayCounter = 0;
					}
				},
				draw: function (context) {
					for (var i = 0; i < this.formation.length; i++) {
						for (var j = 0; j < this.formation[i].length; j++) {
							if (this.formation[i][j] !== 5) {
								context.drawImage(jsGFwk.ResourceManager.graphics.sprites.image,
								146 + (15 * this._currentFrame), 67 + (24 * this.formation[i][j]), 15, 16, 
								(j * 15), (i * 15), 15, 16);
							}
						}
					}
				}
			});
		}
	</script>
	
  </body>
</html>