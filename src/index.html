<!DOCTYPE html>
<html lang="en">
    <head></head>
    <script src="jsgfwk.js" lang="javascript"></script>
    <script src="animator2d.js" lang="javascript"></script>
    <script src="collisions.js" lang="javascript"></script>
    <script src="sprites.js" lang="javascript"></script>
    <script src="resourcesManager.js" lang="javascript"></script>
    <script src="imageFilters.js" lang="javascript"></script>
    <body>

        <canvas id="canvas" width="640" height="480"></canvas>

        <script>
            const game = new jsGFwk();
            const animator = new Animator2D();
            const collisions = new Collisions();
            const resourceManager = new ResourcesManager();
            const sprites = new Sprites();

            game.include(animator);
            game.include(collisions);
            game.include(resourceManager);
            game.include(sprites);
            
            resourceManager.addGraphic({ 
                name: "graphics", 
                source: "./examples/jumpingBase.png" 
            });

            // defining the sounds of the game
            var sources = {};
            sources[ResourcesManager.SOUND_FORMATS.WAVE] = { source: "./examples/ezq.wav" };
            sources[ResourcesManager.SOUND_FORMATS.OGG] = { source: "./examples/ezq.ogg" };
            sources[ResourcesManager.SOUND_FORMATS.MP3] = { source: "./examples/ezq.mp3" };
            
            // adding the sound to the resource manager
            resourceManager.addSound({ 
                name: "music", 
                sources: sources
            });

            let redRectangleObject = {
                name: crypto.randomUUID(),
                isVisible: true,
                x: 0,
                y: 0,
                width: 100,
                height: 100,
                update: function () {
                    this.x += 1;
                    this.y += 1;

                    this.isVisible = !this.isRectColliding(blueRectangleObject);
                },
                draw: function (context) {
                    context.fillStyle = '#FF0000';
                    context.fillRect(this.x, this.y, this.width, this.height);
                }
            };

            let blueRectangleObject = {
                name: crypto.randomUUID(),
                isVisible: true,
                x: 200,
                y: 200,
                width: 20,
                height: 20,
                update: function (delta) {
                    sprites.SPRITES_BAG.fallingGuy.moveNextSprite();
                },
                draw: function (context) {
                    context.fillStyle = '#0000FF';
                    context.fillRect(this.x, this.y, this.width, this.height);

                    context.drawImage(sprites.SPRITES_BAG.fallingGuy.sprite.image, 400, 10);
                }
            };

            resourceManager.onResourcesLoadedCompleted = function () {
                console.log("All resources loaded!");

                // creating the sprites
                sprites.createCollection("fallingGuy", resourceManager.GRAPHICS.graphics.image, 
					[{left: 409, top: 34, width: 66, height: 26},
					 {left: 480, top: 34, width: 66, height: 26},
					 {left: 558, top: 34, width: 66, height: 26}],
                    /*ImageFilters.INVERTCOLOR*/);

                // reseting the sprites
                sprites.SPRITES_BAG.fallingGuy.loop(true);
                sprites.SPRITES_BAG.fallingGuy.reset();

                // adding the objects to the game
                game.createObject(redRectangleObject);
                game.createObject(blueRectangleObject);
            };

            game.start();
        </script>
    </body>
</html>